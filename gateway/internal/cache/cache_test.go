package cache

import (
	"github.com/go-playground/assert/v2"
	"github.com/pygzfei/issuer-gateway/gateway/internal/config"
	"github.com/pygzfei/issuer-gateway/utils"
	"reflect"
	"testing"
)

func TestInit(t *testing.T) {
	type args struct {
		config *config.Config
	}
	tests := []struct {
		name string
		args args
	}{
		{
			name: "can create instance",
			args: struct{ config *config.Config }{config: &config.Config{}},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			Init(tt.args.config)
		})
	}
}

func TestMemoryCache_Delete(t *testing.T) {

	Init(&config.Config{Secret: "66d2e42661bc292f8237b4736a423a36"})

	tests := []struct {
		name string
	}{
		{
			name: "test cache can delete success",
		},
	}
	for _, tt := range tests {

		t.Run(tt.name, func(t *testing.T) {
			key := "123123"
			GlobalCache.Set(key, Cert{})
			GlobalCache.Delete(key)
			if _, b := GlobalCache.Get(key); b {
				t.Errorf("b must be false, but: [%v]", b)
			}
		})
	}
}

func TestMemoryCache_SetRange(t *testing.T) {

	type args struct {
		certs *[]Cert
	}
	tests := []struct {
		name    string
		args    args
		total   int
		wantErr bool
	}{
		{
			name: "test cache can set range success",
			args: struct{ certs *[]Cert }{certs: &[]Cert{
				{
					Id:          uint64(utils.Id()),
					Domain:      "test.anson.com",
					Certificate: "d019dd1c536a7f5a90953e4bf92017c02b0e4880618dd48b3072d01e8deab1593630968b21e4c64e0feff77385ccd5a5b5d6afd116be9d2dc42479f9dd392963effad5dcfbec71d75f46bf7d9520830528601a73c850ab428b974ae734f716ed594dbf2a729d1105b081ac2857590dd956c936d69620b15775e2bb96cc0dea9c325c2cacecdcbdbcbaad81f8547e31d51a8717b94a3e62dcfcb3f0e52955ef6146fc370041c06d84dea27ec4137bf49cf97c0032b0513e12c6d6aa5c45025a9f11e539c28d42691bdfdeb32ce23479004c6f91f26f0eb3969a20a77b56e9239bfd629ed5a58602bf181b6b8125deecccf404e41246db76138596c9a26153f0b1b557ef800159032baf21d3fc9061db0a0d794de1e6aa201413540cd07fbdb472151b5ab70103b8e82f5e8eb16092cd05aae704b897fc2b133a9322bcafc44f5a4ec61ba1d28df20825b71f7e5b251c2aac8e3e5eab0a79a30f404d3613c6712ec17dd5c6f7cbdf60c0f97c2e8053b3c8da0ab92393f88c1b6650bfa4f40ab6a83a677963ae7b685920ae45b89f644c3bd5008ba19cac6aa8b0fd843ad69bfd8dbbd4f41560dbf77eb791a0959199ab3c2cfa5867f4419faa73ea11e20a3a3fe4dbccb728d79d4fb543ed069798bbf91b289ada03fe01ef2ad8709779c336b162050e6bc2536f0be4c99abfad0192ae7daa4fd893df0581d7713df8d198898b7baa51e3725f4d7413efa294f52f0f00971e233135c9b44cee83979a70532769f123eeb6e67248987127cae00cdee7c4f934eb5b8fcd15f9464915c2597f7f2058b75184d5ba5a84761a9793bff56e5cccdf1439921fe7a413d25988ecd664152acf5021993f70e40182f6b2f16c4a8f383b711e836111a120ae2011a26c51f65c80920b28dae728d8635b8ebc8f3beece2f132ea2d244a51639e9a74844012e984fd56fc061223a9361d76f888794b4d9dc8d0b3ec8d33adda44702359ec5978305998a92ece4799a6f06bfe1c969553bf57598addf5f6e3446fb74896892e52fcb8377a54417cc7f0b4016017b52197640b19ed2e23443a28403d1a3dc500042ca43657e455da0c01c7c3c4b5653599bbe695119253e2c14838e590b0fdebc43c8539827797d57a6478a21d23dea7e4fe7fe320b54f62843c736d7b564f747cd52c525dbd286ea3e62708d70c0ec3cb285bb49483a1cdf5500fd2b297052af4e684357469e40c1f063f129616a4cbc80f07a699ec8617ffe2ea4e5aa08a9f530e2e8f996babd1614731660604d12083583367a0a15b6f1b549ac8dea1cb3d70d3965e767d694191d209c4f428125f9ca318326ca2ec663d370a7a24a94c1a3021957b7ab847bbd6e55fbb7a07ed6b1cf4c81822af620c5f37bf4b4b167c15c8fb99262ed1ba3640210c56947d184d4431a4a76a5277c05d3dcf7163e053d8879a6f1946380f92cb0d8113e57b03b96ca3ddc24a6a609dae76f0c9b445f388b4a78837d83b078dca65867ac6029146e55c5313274e60b452a9e0647e07fc74aebd1fc59caa97a46229ca66e392830d83d21da78c69e533e35eb9ec428ce930bb2a62ca4002389eca590c901ef6de1cac5b669da32fa1f03d232c0e2f820329ac9a636f4f555ee9dbbd91033e071e73e562c7dea0c0ca3ebf2d1536ee5988235aa246e9a73d82371acb6f828046e7cb04c36427a81c409af82cc927b550fe08f02db8d1afaa6ad03354fabec159308ff81676495e64dda77f7c9ed9f66ba521ede6667e30db8503eb1b1272be9bf3f2c87d6b6104b1c2a727fd5bf96bfda7ef9a001f9297871d1b28a6112d3e6b77f57dcf4116b94d1b2d5bea9c517d27dee807ed377b5adba18960c2ac36d78a84fdf195b9674a96a10754a57bcee9cd2094d2436047497a016a7bd50060f70a81dd97d66f0e3617744b45bf7b7650db2b424dfd058e4c00b39a26a722011ec95bea2f358d23d9a56fcf0975642d539c78e7ed91326dfb49957477a06aee804587b3323cff3fa4ee356892011c7928b99b1479af80b05b4b485dd1fd234e0940bbe73a9b6a0e795f5dc5f6e06df66516b3a85254ae11f70e0f946f013bd077ca7ec82035b3d1f0b513f36fef25a755f1085ac959eb1fb1b6f36289d3a737405360070111e340c45f7560ab9",
					PrivateKey:  "6f3a0afe10e9a5fb192212ce2901f5332a715f41cf003d507c708b1a88303574a42bb78479e23ec252609ef939dee51a0a233b220435feaef50ae696626d5d1ccad37ebb6b2fdd609141a4cd702eba18b5fee27d2d6e142e216b131c9124198e195a8434a3f4b1cdad2c5a2d26421dfc01dbe8326b1685a3524b05f5a0c2c6eb434b87233c7b4642be4c793a93b97ee71ccb9a0bd4e811f1c414cd3b0a1311b6c5addf702340f6b8a6462e4c82ad61cf65011d8774ac5ed244776d879732f2ca22b21712b93c9f049ed53dc00bd7bea6182cf7666b8b8756800939b9a72f2ada443d506b58c0e157b347aeb80dbb98a6ddf7df65e4618b3f1b6553236ef5495efdf23f3a7f3edc8f57ccff2b3843bbc288a0b82be2ece07919872ab044712d33cd46e176d0b9b14c682776480230ee2ad95f39b5c54daee999a4f4333bf0dfb1c024014f5287c0c7c135f3c3d8c6a610548a02b249c3972f9fbfb825ecdbaeb441810c3fd2798b2667b601a67795072e71041f727ce9607558137fb4c946ffee9da0e3ff0325e52cc0193907f8dcefbce1c84d57abd0f523b29358bf9cf999db22f16f443b596d636c1e110d2eb24860cf35f3dd6a54d2f5e550ebb05ed4756cadd8e1bda3d19203c5a5b3f08b330dd6a568160b64cab75f28c5066bb79dbd30cf74d3da57875c0c29f5b5e15d97beeaa4d66920bb413f2ba2c9b8b499b9293b9c6adf3c88e55877bcc2dc7a7327ff5a6d45e3bc06bff5332028f59f75a99201494fbf4de4b12a66b2217f184f72392bb3ca4e0cbdc621ebd661244f513f007841987a81f270aa1ec6bfe8428f3e74791392e8f769eb462f8894218de99e3078199453971a39c52fad0030df6606ca94e6531faeac23fec38d9a9505154ef399880cb97192a4ad57d2a56749803b98dc197b255da6e32095cf8fb7de8f4df93ce92726c482000e5b7f0b659baa7e92e7d594edff792ff09f5b31eede3259d89450b19bf4421902cd9cdd92dd45b19009e79c69df6c40f099db513acbe1d76b034118f12db08cbcfc2c511ae65bad4b5a00479c83f184458715ec442a762ea255c56b887f1a580a73c552b242237bcbefba3a3b01be2e5b2c96cfca32e37101b769d299b82c9f95f0e40092caf935010c241c3eba8f8b22a555d9688f5edb099d7a8cc21dda56502f311abcffbd5bd309508693280ea014d030e7e1b784ab1ecb971cec26a800f383670050129ba54efcc3dbd4e6ee99d48747eb1009107d30e9b7587929e0e9c5191db44a8f0cc3d55ddb3ea8fcf5af1aad9daa286cfae4f0e774e30e1ca7468172d6bce9cc82db6c9b800ed1ac4a27911864592765492245e92ae64a2468852fac50c0bd47a495bac6c2dd785a85032b80776bb6b6c47dae49b721526e0825867a4bcfbf0f79b309e727f97a9a3581f703fc0edff609c61a783921b620bdcb7e9657493a500fa188372b977e07d9a8ff83c27946119590095b9b1276c78c9d1beb5dd88883d3f1cd7e6e9e72225442317b586ea32bee2b4b75bd146f99e2f05fe394ca3066421e3d94131153ceb7b0e415b37e3d22580390ce30cc03f8b4d05d660a3de069e459796ed0dadaf0106b3677e504bf25465150a62d82a0a77c447fb8de33bfdc7a3d85a57a9c269a6b7d42257e729fad9341add2a146f4375d27e18eed4e4a54a49ecf35e32a990f6e4baace186f03c073a3d13662eb616e83cff7032802ed0a7d10cc658cf54a0ca04666fe6e967cb7719fa5a87e3bae36e8960b5fc83c542e8f051243ef585d865fe1d509544181ca1847e833d2c4d676c8fd72800c59ef878f805cf916ba161d5e561c787ca813a8cb2bbefa5d02f383d1e899d14e8e63d4962f2e9d4ebb1ebd25a00beebf0cfee09caef843f5a66022c55ff7a8f32f1a7ca9f4c0e62c8b8b6ac1a825ee7e44ad2a50e1c3a4146ca85ba9f57549ce93f48115b746e43438443b113a8a3e7f9e3ff777e19118ae114ee005cca51cf09c7db2a590d6c48b560c0e79c123034519fe9909aaed9196890969a801ce85b75cbc796f0ab192f67aae22e868b3142e379d53cd035e20bb6857327ec9314c88e8e3646c6e2e7d73b3b18e87a60a0441d6f193ca89694d657682bc6d50dad7649d43463f53cef64c2c807535e4abf29aa87cabeb07253ec1d0ada54e204892852c017e211824840b5cd19d1b0c47ee718ace2dbf919a15291bdc31a285b6c962ed971a0c7c3669fcbf36e13bc584e2300e59606ba803ee04cd7c5fbb0533c7b57f8acc718a75ddba4e94c6c612336e32f91bd5cd640e4b3b47cc2f3121fbe7d15895541c54ab804eb3985796164d009862b2cd522403ddf23ab3b0f306c3cb4f6dfab6e561fe551d250a55ef9465e733a6baf7a6f1866f591aa4ddc4492f85f4dccb47858f40252cbde1272a6fed",
				},
				{
					Id:          uint64(utils.Id()),
					Domain:      "test1.anson.com",
					Certificate: "d019dd1c536a7f5a90953e4bf92017c02b0e4880618dd48b3072d01e8deab1593630968b21e4c64e0feff77385ccd5a5b5d6afd116be9d2dc42479f9dd392963effad5dcfbec71d75f46bf7d9520830528601a73c850ab428b974ae734f716ed594dbf2a729d1105b081ac2857590dd956c936d69620b15775e2bb96cc0dea9c325c2cacecdcbdbcbaad81f8547e31d51a8717b94a3e62dcfcb3f0e52955ef6146fc370041c06d84dea27ec4137bf49cf97c0032b0513e12c6d6aa5c45025a9f11e539c28d42691bdfdeb32ce23479004c6f91f26f0eb3969a20a77b56e9239bfd629ed5a58602bf181b6b8125deecccf404e41246db76138596c9a26153f0b1b557ef800159032baf21d3fc9061db0a0d794de1e6aa201413540cd07fbdb472151b5ab70103b8e82f5e8eb16092cd05aae704b897fc2b133a9322bcafc44f5a4ec61ba1d28df20825b71f7e5b251c2aac8e3e5eab0a79a30f404d3613c6712ec17dd5c6f7cbdf60c0f97c2e8053b3c8da0ab92393f88c1b6650bfa4f40ab6a83a677963ae7b685920ae45b89f644c3bd5008ba19cac6aa8b0fd843ad69bfd8dbbd4f41560dbf77eb791a0959199ab3c2cfa5867f4419faa73ea11e20a3a3fe4dbccb728d79d4fb543ed069798bbf91b289ada03fe01ef2ad8709779c336b162050e6bc2536f0be4c99abfad0192ae7daa4fd893df0581d7713df8d198898b7baa51e3725f4d7413efa294f52f0f00971e233135c9b44cee83979a70532769f123eeb6e67248987127cae00cdee7c4f934eb5b8fcd15f9464915c2597f7f2058b75184d5ba5a84761a9793bff56e5cccdf1439921fe7a413d25988ecd664152acf5021993f70e40182f6b2f16c4a8f383b711e836111a120ae2011a26c51f65c80920b28dae728d8635b8ebc8f3beece2f132ea2d244a51639e9a74844012e984fd56fc061223a9361d76f888794b4d9dc8d0b3ec8d33adda44702359ec5978305998a92ece4799a6f06bfe1c969553bf57598addf5f6e3446fb74896892e52fcb8377a54417cc7f0b4016017b52197640b19ed2e23443a28403d1a3dc500042ca43657e455da0c01c7c3c4b5653599bbe695119253e2c14838e590b0fdebc43c8539827797d57a6478a21d23dea7e4fe7fe320b54f62843c736d7b564f747cd52c525dbd286ea3e62708d70c0ec3cb285bb49483a1cdf5500fd2b297052af4e684357469e40c1f063f129616a4cbc80f07a699ec8617ffe2ea4e5aa08a9f530e2e8f996babd1614731660604d12083583367a0a15b6f1b549ac8dea1cb3d70d3965e767d694191d209c4f428125f9ca318326ca2ec663d370a7a24a94c1a3021957b7ab847bbd6e55fbb7a07ed6b1cf4c81822af620c5f37bf4b4b167c15c8fb99262ed1ba3640210c56947d184d4431a4a76a5277c05d3dcf7163e053d8879a6f1946380f92cb0d8113e57b03b96ca3ddc24a6a609dae76f0c9b445f388b4a78837d83b078dca65867ac6029146e55c5313274e60b452a9e0647e07fc74aebd1fc59caa97a46229ca66e392830d83d21da78c69e533e35eb9ec428ce930bb2a62ca4002389eca590c901ef6de1cac5b669da32fa1f03d232c0e2f820329ac9a636f4f555ee9dbbd91033e071e73e562c7dea0c0ca3ebf2d1536ee5988235aa246e9a73d82371acb6f828046e7cb04c36427a81c409af82cc927b550fe08f02db8d1afaa6ad03354fabec159308ff81676495e64dda77f7c9ed9f66ba521ede6667e30db8503eb1b1272be9bf3f2c87d6b6104b1c2a727fd5bf96bfda7ef9a001f9297871d1b28a6112d3e6b77f57dcf4116b94d1b2d5bea9c517d27dee807ed377b5adba18960c2ac36d78a84fdf195b9674a96a10754a57bcee9cd2094d2436047497a016a7bd50060f70a81dd97d66f0e3617744b45bf7b7650db2b424dfd058e4c00b39a26a722011ec95bea2f358d23d9a56fcf0975642d539c78e7ed91326dfb49957477a06aee804587b3323cff3fa4ee356892011c7928b99b1479af80b05b4b485dd1fd234e0940bbe73a9b6a0e795f5dc5f6e06df66516b3a85254ae11f70e0f946f013bd077ca7ec82035b3d1f0b513f36fef25a755f1085ac959eb1fb1b6f36289d3a737405360070111e340c45f7560ab9",
					PrivateKey:  "6f3a0afe10e9a5fb192212ce2901f5332a715f41cf003d507c708b1a88303574a42bb78479e23ec252609ef939dee51a0a233b220435feaef50ae696626d5d1ccad37ebb6b2fdd609141a4cd702eba18b5fee27d2d6e142e216b131c9124198e195a8434a3f4b1cdad2c5a2d26421dfc01dbe8326b1685a3524b05f5a0c2c6eb434b87233c7b4642be4c793a93b97ee71ccb9a0bd4e811f1c414cd3b0a1311b6c5addf702340f6b8a6462e4c82ad61cf65011d8774ac5ed244776d879732f2ca22b21712b93c9f049ed53dc00bd7bea6182cf7666b8b8756800939b9a72f2ada443d506b58c0e157b347aeb80dbb98a6ddf7df65e4618b3f1b6553236ef5495efdf23f3a7f3edc8f57ccff2b3843bbc288a0b82be2ece07919872ab044712d33cd46e176d0b9b14c682776480230ee2ad95f39b5c54daee999a4f4333bf0dfb1c024014f5287c0c7c135f3c3d8c6a610548a02b249c3972f9fbfb825ecdbaeb441810c3fd2798b2667b601a67795072e71041f727ce9607558137fb4c946ffee9da0e3ff0325e52cc0193907f8dcefbce1c84d57abd0f523b29358bf9cf999db22f16f443b596d636c1e110d2eb24860cf35f3dd6a54d2f5e550ebb05ed4756cadd8e1bda3d19203c5a5b3f08b330dd6a568160b64cab75f28c5066bb79dbd30cf74d3da57875c0c29f5b5e15d97beeaa4d66920bb413f2ba2c9b8b499b9293b9c6adf3c88e55877bcc2dc7a7327ff5a6d45e3bc06bff5332028f59f75a99201494fbf4de4b12a66b2217f184f72392bb3ca4e0cbdc621ebd661244f513f007841987a81f270aa1ec6bfe8428f3e74791392e8f769eb462f8894218de99e3078199453971a39c52fad0030df6606ca94e6531faeac23fec38d9a9505154ef399880cb97192a4ad57d2a56749803b98dc197b255da6e32095cf8fb7de8f4df93ce92726c482000e5b7f0b659baa7e92e7d594edff792ff09f5b31eede3259d89450b19bf4421902cd9cdd92dd45b19009e79c69df6c40f099db513acbe1d76b034118f12db08cbcfc2c511ae65bad4b5a00479c83f184458715ec442a762ea255c56b887f1a580a73c552b242237bcbefba3a3b01be2e5b2c96cfca32e37101b769d299b82c9f95f0e40092caf935010c241c3eba8f8b22a555d9688f5edb099d7a8cc21dda56502f311abcffbd5bd309508693280ea014d030e7e1b784ab1ecb971cec26a800f383670050129ba54efcc3dbd4e6ee99d48747eb1009107d30e9b7587929e0e9c5191db44a8f0cc3d55ddb3ea8fcf5af1aad9daa286cfae4f0e774e30e1ca7468172d6bce9cc82db6c9b800ed1ac4a27911864592765492245e92ae64a2468852fac50c0bd47a495bac6c2dd785a85032b80776bb6b6c47dae49b721526e0825867a4bcfbf0f79b309e727f97a9a3581f703fc0edff609c61a783921b620bdcb7e9657493a500fa188372b977e07d9a8ff83c27946119590095b9b1276c78c9d1beb5dd88883d3f1cd7e6e9e72225442317b586ea32bee2b4b75bd146f99e2f05fe394ca3066421e3d94131153ceb7b0e415b37e3d22580390ce30cc03f8b4d05d660a3de069e459796ed0dadaf0106b3677e504bf25465150a62d82a0a77c447fb8de33bfdc7a3d85a57a9c269a6b7d42257e729fad9341add2a146f4375d27e18eed4e4a54a49ecf35e32a990f6e4baace186f03c073a3d13662eb616e83cff7032802ed0a7d10cc658cf54a0ca04666fe6e967cb7719fa5a87e3bae36e8960b5fc83c542e8f051243ef585d865fe1d509544181ca1847e833d2c4d676c8fd72800c59ef878f805cf916ba161d5e561c787ca813a8cb2bbefa5d02f383d1e899d14e8e63d4962f2e9d4ebb1ebd25a00beebf0cfee09caef843f5a66022c55ff7a8f32f1a7ca9f4c0e62c8b8b6ac1a825ee7e44ad2a50e1c3a4146ca85ba9f57549ce93f48115b746e43438443b113a8a3e7f9e3ff777e19118ae114ee005cca51cf09c7db2a590d6c48b560c0e79c123034519fe9909aaed9196890969a801ce85b75cbc796f0ab192f67aae22e868b3142e379d53cd035e20bb6857327ec9314c88e8e3646c6e2e7d73b3b18e87a60a0441d6f193ca89694d657682bc6d50dad7649d43463f53cef64c2c807535e4abf29aa87cabeb07253ec1d0ada54e204892852c017e211824840b5cd19d1b0c47ee718ace2dbf919a15291bdc31a285b6c962ed971a0c7c3669fcbf36e13bc584e2300e59606ba803ee04cd7c5fbb0533c7b57f8acc718a75ddba4e94c6c612336e32f91bd5cd640e4b3b47cc2f3121fbe7d15895541c54ab804eb3985796164d009862b2cd522403ddf23ab3b0f306c3cb4f6dfab6e561fe551d250a55ef9465e733a6baf7a6f1866f591aa4ddc4492f85f4dccb47858f40252cbde1272a6fed",
				},
			}},
			total:   2,
			wantErr: false,
		},
		{
			name: "test cache can set range fail",
			args: struct{ certs *[]Cert }{certs: &[]Cert{
				{
					Id:          uint64(utils.Id()),
					Domain:      "test.anson.com",
					Certificate: "9dd1c536a7f5a90953e4bf92017c02b0e4880618dd48b3072d01e8deab1593630968b21e4c64e0feff77385ccd5a5b5d6afd116be9d2dc42479f9dd392963effad5dcfbec71d75f46bf7d9520830528601a73c850ab428b974ae734f716ed594dbf2a729d1105b081ac2857590dd956c936d69620b15775e2bb96cc0dea9c325c2cacecdcbdbcbaad81f8547e31d51a8717b94a3e62dcfcb3f0e52955ef6146fc370041c06d84dea27ec4137bf49cf97c0032b0513e12c6d6aa5c45025a9f11e539c28d42691bdfdeb32ce23479004c6f91f26f0eb3969a20a77b56e9239bfd629ed5a58602bf181b6b8125deecccf404e41246db76138596c9a26153f0b1b557ef800159032baf21d3fc9061db0a0d794de1e6aa201413540cd07fbdb472151b5ab70103b8e82f5e8eb16092cd05aae704b897fc2b133a9322bcafc44f5a4ec61ba1d28df20825b71f7e5b251c2aac8e3e5eab0a79a30f404d3613c6712ec17dd5c6f7cbdf60c0f97c2e8053b3c8da0ab92393f88c1b6650bfa4f40ab6a83a677963ae7b685920ae45b89f644c3bd5008ba19cac6aa8b0fd843ad69bfd8dbbd4f41560dbf77eb791a0959199ab3c2cfa5867f4419faa73ea11e20a3a3fe4dbccb728d79d4fb543ed069798bbf91b289ada03fe01ef2ad8709779c336b162050e6bc2536f0be4c99abfad0192ae7daa4fd893df0581d7713df8d198898b7baa51e3725f4d7413efa294f52f0f00971e233135c9b44cee83979a70532769f123eeb6e67248987127cae00cdee7c4f934eb5b8fcd15f9464915c2597f7f2058b75184d5ba5a84761a9793bff56e5cccdf1439921fe7a413d25988ecd664152acf5021993f70e40182f6b2f16c4a8f383b711e836111a120ae2011a26c51f65c80920b28dae728d8635b8ebc8f3beece2f132ea2d244a51639e9a74844012e984fd56fc061223a9361d76f888794b4d9dc8d0b3ec8d33adda44702359ec5978305998a92ece4799a6f06bfe1c969553bf57598addf5f6e3446fb74896892e52fcb8377a54417cc7f0b4016017b52197640b19ed2e23443a28403d1a3dc500042ca43657e455da0c01c7c3c4b5653599bbe695119253e2c14838e590b0fdebc43c8539827797d57a6478a21d23dea7e4fe7fe320b54f62843c736d7b564f747cd52c525dbd286ea3e62708d70c0ec3cb285bb49483a1cdf5500fd2b297052af4e684357469e40c1f063f129616a4cbc80f07a699ec8617ffe2ea4e5aa08a9f530e2e8f996babd1614731660604d12083583367a0a15b6f1b549ac8dea1cb3d70d3965e767d694191d209c4f428125f9ca318326ca2ec663d370a7a24a94c1a3021957b7ab847bbd6e55fbb7a07ed6b1cf4c81822af620c5f37bf4b4b167c15c8fb99262ed1ba3640210c56947d184d4431a4a76a5277c05d3dcf7163e053d8879a6f1946380f92cb0d8113e57b03b96ca3ddc24a6a609dae76f0c9b445f388b4a78837d83b078dca65867ac6029146e55c5313274e60b452a9e0647e07fc74aebd1fc59caa97a46229ca66e392830d83d21da78c69e533e35eb9ec428ce930bb2a62ca4002389eca590c901ef6de1cac5b669da32fa1f03d232c0e2f820329ac9a636f4f555ee9dbbd91033e071e73e562c7dea0c0ca3ebf2d1536ee5988235aa246e9a73d82371acb6f828046e7cb04c36427a81c409af82cc927b550fe08f02db8d1afaa6ad03354fabec159308ff81676495e64dda77f7c9ed9f66ba521ede6667e30db8503eb1b1272be9bf3f2c87d6b6104b1c2a727fd5bf96bfda7ef9a001f9297871d1b28a6112d3e6b77f57dcf4116b94d1b2d5bea9c517d27dee807ed377b5adba18960c2ac36d78a84fdf195b9674a96a10754a57bcee9cd2094d2436047497a016a7bd50060f70a81dd97d66f0e3617744b45bf7b7650db2b424dfd058e4c00b39a26a722011ec95bea2f358d23d9a56fcf0975642d539c78e7ed91326dfb49957477a06aee804587b3323cff3fa4ee356892011c7928b99b1479af80b05b4b485dd1fd234e0940bbe73a9b6a0e795f5dc5f6e06df66516b3a85254ae11f70e0f946f013bd077ca7ec82035b3d1f0b513f36fef25a755f1085ac959eb1fb1b6f36289d3a737405360070111e340c45f7560ab9",
					PrivateKey:  "6f3a0afe10e9a5fb192212ce2901f5332a715f41cf003d507c708b1a88303574a42bb78479e23ec252609ef939dee51a0a233b220435feaef50ae696626d5d1ccad37ebb6b2fdd609141a4cd702eba18b5fee27d2d6e142e216b131c9124198e195a8434a3f4b1cdad2c5a2d26421dfc01dbe8326b1685a3524b05f5a0c2c6eb434b87233c7b4642be4c793a93b97ee71ccb9a0bd4e811f1c414cd3b0a1311b6c5addf702340f6b8a6462e4c82ad61cf65011d8774ac5ed244776d879732f2ca22b21712b93c9f049ed53dc00bd7bea6182cf7666b8b8756800939b9a72f2ada443d506b58c0e157b347aeb80dbb98a6ddf7df65e4618b3f1b6553236ef5495efdf23f3a7f3edc8f57ccff2b3843bbc288a0b82be2ece07919872ab044712d33cd46e176d0b9b14c682776480230ee2ad95f39b5c54daee999a4f4333bf0dfb1c024014f5287c0c7c135f3c3d8c6a610548a02b249c3972f9fbfb825ecdbaeb441810c3fd2798b2667b601a67795072e71041f727ce9607558137fb4c946ffee9da0e3ff0325e52cc0193907f8dcefbce1c84d57abd0f523b29358bf9cf999db22f16f443b596d636c1e110d2eb24860cf35f3dd6a54d2f5e550ebb05ed4756cadd8e1bda3d19203c5a5b3f08b330dd6a568160b64cab75f28c5066bb79dbd30cf74d3da57875c0c29f5b5e15d97beeaa4d66920bb413f2ba2c9b8b499b9293b9c6adf3c88e55877bcc2dc7a7327ff5a6d45e3bc06bff5332028f59f75a99201494fbf4de4b12a66b2217f184f72392bb3ca4e0cbdc621ebd661244f513f007841987a81f270aa1ec6bfe8428f3e74791392e8f769eb462f8894218de99e3078199453971a39c52fad0030df6606ca94e6531faeac23fec38d9a9505154ef399880cb97192a4ad57d2a56749803b98dc197b255da6e32095cf8fb7de8f4df93ce92726c482000e5b7f0b659baa7e92e7d594edff792ff09f5b31eede3259d89450b19bf4421902cd9cdd92dd45b19009e79c69df6c40f099db513acbe1d76b034118f12db08cbcfc2c511ae65bad4b5a00479c83f184458715ec442a762ea255c56b887f1a580a73c552b242237bcbefba3a3b01be2e5b2c96cfca32e37101b769d299b82c9f95f0e40092caf935010c241c3eba8f8b22a555d9688f5edb099d7a8cc21dda56502f311abcffbd5bd309508693280ea014d030e7e1b784ab1ecb971cec26a800f383670050129ba54efcc3dbd4e6ee99d48747eb1009107d30e9b7587929e0e9c5191db44a8f0cc3d55ddb3ea8fcf5af1aad9daa286cfae4f0e774e30e1ca7468172d6bce9cc82db6c9b800ed1ac4a27911864592765492245e92ae64a2468852fac50c0bd47a495bac6c2dd785a85032b80776bb6b6c47dae49b721526e0825867a4bcfbf0f79b309e727f97a9a3581f703fc0edff609c61a783921b620bdcb7e9657493a500fa188372b977e07d9a8ff83c27946119590095b9b1276c78c9d1beb5dd88883d3f1cd7e6e9e72225442317b586ea32bee2b4b75bd146f99e2f05fe394ca3066421e3d94131153ceb7b0e415b37e3d22580390ce30cc03f8b4d05d660a3de069e459796ed0dadaf0106b3677e504bf25465150a62d82a0a77c447fb8de33bfdc7a3d85a57a9c269a6b7d42257e729fad9341add2a146f4375d27e18eed4e4a54a49ecf35e32a990f6e4baace186f03c073a3d13662eb616e83cff7032802ed0a7d10cc658cf54a0ca04666fe6e967cb7719fa5a87e3bae36e8960b5fc83c542e8f051243ef585d865fe1d509544181ca1847e833d2c4d676c8fd72800c59ef878f805cf916ba161d5e561c787ca813a8cb2bbefa5d02f383d1e899d14e8e63d4962f2e9d4ebb1ebd25a00beebf0cfee09caef843f5a66022c55ff7a8f32f1a7ca9f4c0e62c8b8b6ac1a825ee7e44ad2a50e1c3a4146ca85ba9f57549ce93f48115b746e43438443b113a8a3e7f9e3ff777e19118ae114ee005cca51cf09c7db2a590d6c48b560c0e79c123034519fe9909aaed9196890969a801ce85b75cbc796f0ab192f67aae22e868b3142e379d53cd035e20bb6857327ec9314c88e8e3646c6e2e7d73b3b18e87a60a0441d6f193ca89694d657682bc6d50dad7649d43463f53cef64c2c807535e4abf29aa87cabeb07253ec1d0ada54e204892852c017e211824840b5cd19d1b0c47ee718ace2dbf919a15291bdc31a285b6c962ed971a0c7c3669fcbf36e13bc584e2300e59606ba803ee04cd7c5fbb0533c7b57f8acc718a75ddba4e94c6c612336e32f91bd5cd640e4b3b47cc2f3121fbe7d15895541c54ab804eb3985796164d009862b2cd522403ddf23ab3b0f306c3cb4f6dfab6e561fe551d250a55ef9465e733a6baf7a6f1866f591aa4ddc4492f85f4dccb47858f40252cbde1272a6fed",
				},
				{
					Id:          uint64(utils.Id()),
					Domain:      "test1.anson.com",
					Certificate: "d019dd1c536a7f5a90953e4bf92017c02b0e4880618dd48b3072d01e8deab1593630968b21e4c64e0feff77385ccd5a5b5d6afd116be9d2dc42479f9dd392963effad5dcfbec71d75f46bf7d9520830528601a73c850ab428b974ae734f716ed594dbf2a729d1105b081ac2857590dd956c936d69620b15775e2bb96cc0dea9c325c2cacecdcbdbcbaad81f8547e31d51a8717b94a3e62dcfcb3f0e52955ef6146fc370041c06d84dea27ec4137bf49cf97c0032b0513e12c6d6aa5c45025a9f11e539c28d42691bdfdeb32ce23479004c6f91f26f0eb3969a20a77b56e9239bfd629ed5a58602bf181b6b8125deecccf404e41246db76138596c9a26153f0b1b557ef800159032baf21d3fc9061db0a0d794de1e6aa201413540cd07fbdb472151b5ab70103b8e82f5e8eb16092cd05aae704b897fc2b133a9322bcafc44f5a4ec61ba1d28df20825b71f7e5b251c2aac8e3e5eab0a79a30f404d3613c6712ec17dd5c6f7cbdf60c0f97c2e8053b3c8da0ab92393f88c1b6650bfa4f40ab6a83a677963ae7b685920ae45b89f644c3bd5008ba19cac6aa8b0fd843ad69bfd8dbbd4f41560dbf77eb791a0959199ab3c2cfa5867f4419faa73ea11e20a3a3fe4dbccb728d79d4fb543ed069798bbf91b289ada03fe01ef2ad8709779c336b162050e6bc2536f0be4c99abfad0192ae7daa4fd893df0581d7713df8d198898b7baa51e3725f4d7413efa294f52f0f00971e233135c9b44cee83979a70532769f123eeb6e67248987127cae00cdee7c4f934eb5b8fcd15f9464915c2597f7f2058b75184d5ba5a84761a9793bff56e5cccdf1439921fe7a413d25988ecd664152acf5021993f70e40182f6b2f16c4a8f383b711e836111a120ae2011a26c51f65c80920b28dae728d8635b8ebc8f3beece2f132ea2d244a51639e9a74844012e984fd56fc061223a9361d76f888794b4d9dc8d0b3ec8d33adda44702359ec5978305998a92ece4799a6f06bfe1c969553bf57598addf5f6e3446fb74896892e52fcb8377a54417cc7f0b4016017b52197640b19ed2e23443a28403d1a3dc500042ca43657e455da0c01c7c3c4b5653599bbe695119253e2c14838e590b0fdebc43c8539827797d57a6478a21d23dea7e4fe7fe320b54f62843c736d7b564f747cd52c525dbd286ea3e62708d70c0ec3cb285bb49483a1cdf5500fd2b297052af4e684357469e40c1f063f129616a4cbc80f07a699ec8617ffe2ea4e5aa08a9f530e2e8f996babd1614731660604d12083583367a0a15b6f1b549ac8dea1cb3d70d3965e767d694191d209c4f428125f9ca318326ca2ec663d370a7a24a94c1a3021957b7ab847bbd6e55fbb7a07ed6b1cf4c81822af620c5f37bf4b4b167c15c8fb99262ed1ba3640210c56947d184d4431a4a76a5277c05d3dcf7163e053d8879a6f1946380f92cb0d8113e57b03b96ca3ddc24a6a609dae76f0c9b445f388b4a78837d83b078dca65867ac6029146e55c5313274e60b452a9e0647e07fc74aebd1fc59caa97a46229ca66e392830d83d21da78c69e533e35eb9ec428ce930bb2a62ca4002389eca590c901ef6de1cac5b669da32fa1f03d232c0e2f820329ac9a636f4f555ee9dbbd91033e071e73e562c7dea0c0ca3ebf2d1536ee5988235aa246e9a73d82371acb6f828046e7cb04c36427a81c409af82cc927b550fe08f02db8d1afaa6ad03354fabec159308ff81676495e64dda77f7c9ed9f66ba521ede6667e30db8503eb1b1272be9bf3f2c87d6b6104b1c2a727fd5bf96bfda7ef9a001f9297871d1b28a6112d3e6b77f57dcf4116b94d1b2d5bea9c517d27dee807ed377b5adba18960c2ac36d78a84fdf195b9674a96a10754a57bcee9cd2094d2436047497a016a7bd50060f70a81dd97d66f0e3617744b45bf7b7650db2b424dfd058e4c00b39a26a722011ec95bea2f358d23d9a56fcf0975642d539c78e7ed91326dfb49957477a06aee804587b3323cff3fa4ee356892011c7928b99b1479af80b05b4b485dd1fd234e0940bbe73a9b6a0e795f5dc5f6e06df66516b3a85254ae11f70e0f946f013bd077ca7ec82035b3d1f0b513f36fef25a755f1085ac959eb1fb1b6f36289d3a737405360070111e340c45f7560ab9",
					PrivateKey:  "6f3a0afe10e9a5fb192212ce2901f5332a715f41cf003d507c708b1a88303574a42bb78479e23ec252609ef939dee51a0a233b220435feaef50ae696626d5d1ccad37ebb6b2fdd609141a4cd702eba18b5fee27d2d6e142e216b131c9124198e195a8434a3f4b1cdad2c5a2d26421dfc01dbe8326b1685a3524b05f5a0c2c6eb434b87233c7b4642be4c793a93b97ee71ccb9a0bd4e811f1c414cd3b0a1311b6c5addf702340f6b8a6462e4c82ad61cf65011d8774ac5ed244776d879732f2ca22b21712b93c9f049ed53dc00bd7bea6182cf7666b8b8756800939b9a72f2ada443d506b58c0e157b347aeb80dbb98a6ddf7df65e4618b3f1b6553236ef5495efdf23f3a7f3edc8f57ccff2b3843bbc288a0b82be2ece07919872ab044712d33cd46e176d0b9b14c682776480230ee2ad95f39b5c54daee999a4f4333bf0dfb1c024014f5287c0c7c135f3c3d8c6a610548a02b249c3972f9fbfb825ecdbaeb441810c3fd2798b2667b601a67795072e71041f727ce9607558137fb4c946ffee9da0e3ff0325e52cc0193907f8dcefbce1c84d57abd0f523b29358bf9cf999db22f16f443b596d636c1e110d2eb24860cf35f3dd6a54d2f5e550ebb05ed4756cadd8e1bda3d19203c5a5b3f08b330dd6a568160b64cab75f28c5066bb79dbd30cf74d3da57875c0c29f5b5e15d97beeaa4d66920bb413f2ba2c9b8b499b9293b9c6adf3c88e55877bcc2dc7a7327ff5a6d45e3bc06bff5332028f59f75a99201494fbf4de4b12a66b2217f184f72392bb3ca4e0cbdc621ebd661244f513f007841987a81f270aa1ec6bfe8428f3e74791392e8f769eb462f8894218de99e3078199453971a39c52fad0030df6606ca94e6531faeac23fec38d9a9505154ef399880cb97192a4ad57d2a56749803b98dc197b255da6e32095cf8fb7de8f4df93ce92726c482000e5b7f0b659baa7e92e7d594edff792ff09f5b31eede3259d89450b19bf4421902cd9cdd92dd45b19009e79c69df6c40f099db513acbe1d76b034118f12db08cbcfc2c511ae65bad4b5a00479c83f184458715ec442a762ea255c56b887f1a580a73c552b242237bcbefba3a3b01be2e5b2c96cfca32e37101b769d299b82c9f95f0e40092caf935010c241c3eba8f8b22a555d9688f5edb099d7a8cc21dda56502f311abcffbd5bd309508693280ea014d030e7e1b784ab1ecb971cec26a800f383670050129ba54efcc3dbd4e6ee99d48747eb1009107d30e9b7587929e0e9c5191db44a8f0cc3d55ddb3ea8fcf5af1aad9daa286cfae4f0e774e30e1ca7468172d6bce9cc82db6c9b800ed1ac4a27911864592765492245e92ae64a2468852fac50c0bd47a495bac6c2dd785a85032b80776bb6b6c47dae49b721526e0825867a4bcfbf0f79b309e727f97a9a3581f703fc0edff609c61a783921b620bdcb7e9657493a500fa188372b977e07d9a8ff83c27946119590095b9b1276c78c9d1beb5dd88883d3f1cd7e6e9e72225442317b586ea32bee2b4b75bd146f99e2f05fe394ca3066421e3d94131153ceb7b0e415b37e3d22580390ce30cc03f8b4d05d660a3de069e459796ed0dadaf0106b3677e504bf25465150a62d82a0a77c447fb8de33bfdc7a3d85a57a9c269a6b7d42257e729fad9341add2a146f4375d27e18eed4e4a54a49ecf35e32a990f6e4baace186f03c073a3d13662eb616e83cff7032802ed0a7d10cc658cf54a0ca04666fe6e967cb7719fa5a87e3bae36e8960b5fc83c542e8f051243ef585d865fe1d509544181ca1847e833d2c4d676c8fd72800c59ef878f805cf916ba161d5e561c787ca813a8cb2bbefa5d02f383d1e899d14e8e63d4962f2e9d4ebb1ebd25a00beebf0cfee09caef843f5a66022c55ff7a8f32f1a7ca9f4c0e62c8b8b6ac1a825ee7e44ad2a50e1c3a4146ca85ba9f57549ce93f48115b746e43438443b113a8a3e7f9e3ff777e19118ae114ee005cca51cf09c7db2a590d6c48b560c0e79c123034519fe9909aaed9196890969a801ce85b75cbc796f0ab192f67aae22e868b3142e379d53cd035e20bb6857327ec9314c88e8e3646c6e2e7d73b3b18e87a60a0441d6f193ca89694d657682bc6d50dad7649d43463f53cef64c2c807535e4abf29aa87cabeb07253ec1d0ada54e204892852c017e211824840b5cd19d1b0c47ee718ace2dbf919a15291bdc31a285b6c962ed971a0c7c3669fcbf36e13bc584e2300e59606ba803ee04cd7c5fbb0533c7b57f8acc718a75ddba4e94c6c612336e32f91bd5cd640e4b3b47cc2f3121fbe7d15895541c54ab804eb3985796164d009862b2cd522403ddf23ab3b0f306c3cb4f6dfab6e561fe551d250a55ef9465e733a6baf7a6f1866f591aa4ddc4492f85f4dccb47858f40252cbde1272a6fed",
				},
			}},
			total:   0,
			wantErr: true,
		},
		{
			name: "test cache can set range will cover the same domain name",
			args: struct{ certs *[]Cert }{certs: &[]Cert{
				{
					Id:          uint64(utils.Id()),
					Domain:      "test.anson.com",
					Certificate: "d019dd1c536a7f5a90953e4bf92017c02b0e4880618dd48b3072d01e8deab1593630968b21e4c64e0feff77385ccd5a5b5d6afd116be9d2dc42479f9dd392963effad5dcfbec71d75f46bf7d9520830528601a73c850ab428b974ae734f716ed594dbf2a729d1105b081ac2857590dd956c936d69620b15775e2bb96cc0dea9c325c2cacecdcbdbcbaad81f8547e31d51a8717b94a3e62dcfcb3f0e52955ef6146fc370041c06d84dea27ec4137bf49cf97c0032b0513e12c6d6aa5c45025a9f11e539c28d42691bdfdeb32ce23479004c6f91f26f0eb3969a20a77b56e9239bfd629ed5a58602bf181b6b8125deecccf404e41246db76138596c9a26153f0b1b557ef800159032baf21d3fc9061db0a0d794de1e6aa201413540cd07fbdb472151b5ab70103b8e82f5e8eb16092cd05aae704b897fc2b133a9322bcafc44f5a4ec61ba1d28df20825b71f7e5b251c2aac8e3e5eab0a79a30f404d3613c6712ec17dd5c6f7cbdf60c0f97c2e8053b3c8da0ab92393f88c1b6650bfa4f40ab6a83a677963ae7b685920ae45b89f644c3bd5008ba19cac6aa8b0fd843ad69bfd8dbbd4f41560dbf77eb791a0959199ab3c2cfa5867f4419faa73ea11e20a3a3fe4dbccb728d79d4fb543ed069798bbf91b289ada03fe01ef2ad8709779c336b162050e6bc2536f0be4c99abfad0192ae7daa4fd893df0581d7713df8d198898b7baa51e3725f4d7413efa294f52f0f00971e233135c9b44cee83979a70532769f123eeb6e67248987127cae00cdee7c4f934eb5b8fcd15f9464915c2597f7f2058b75184d5ba5a84761a9793bff56e5cccdf1439921fe7a413d25988ecd664152acf5021993f70e40182f6b2f16c4a8f383b711e836111a120ae2011a26c51f65c80920b28dae728d8635b8ebc8f3beece2f132ea2d244a51639e9a74844012e984fd56fc061223a9361d76f888794b4d9dc8d0b3ec8d33adda44702359ec5978305998a92ece4799a6f06bfe1c969553bf57598addf5f6e3446fb74896892e52fcb8377a54417cc7f0b4016017b52197640b19ed2e23443a28403d1a3dc500042ca43657e455da0c01c7c3c4b5653599bbe695119253e2c14838e590b0fdebc43c8539827797d57a6478a21d23dea7e4fe7fe320b54f62843c736d7b564f747cd52c525dbd286ea3e62708d70c0ec3cb285bb49483a1cdf5500fd2b297052af4e684357469e40c1f063f129616a4cbc80f07a699ec8617ffe2ea4e5aa08a9f530e2e8f996babd1614731660604d12083583367a0a15b6f1b549ac8dea1cb3d70d3965e767d694191d209c4f428125f9ca318326ca2ec663d370a7a24a94c1a3021957b7ab847bbd6e55fbb7a07ed6b1cf4c81822af620c5f37bf4b4b167c15c8fb99262ed1ba3640210c56947d184d4431a4a76a5277c05d3dcf7163e053d8879a6f1946380f92cb0d8113e57b03b96ca3ddc24a6a609dae76f0c9b445f388b4a78837d83b078dca65867ac6029146e55c5313274e60b452a9e0647e07fc74aebd1fc59caa97a46229ca66e392830d83d21da78c69e533e35eb9ec428ce930bb2a62ca4002389eca590c901ef6de1cac5b669da32fa1f03d232c0e2f820329ac9a636f4f555ee9dbbd91033e071e73e562c7dea0c0ca3ebf2d1536ee5988235aa246e9a73d82371acb6f828046e7cb04c36427a81c409af82cc927b550fe08f02db8d1afaa6ad03354fabec159308ff81676495e64dda77f7c9ed9f66ba521ede6667e30db8503eb1b1272be9bf3f2c87d6b6104b1c2a727fd5bf96bfda7ef9a001f9297871d1b28a6112d3e6b77f57dcf4116b94d1b2d5bea9c517d27dee807ed377b5adba18960c2ac36d78a84fdf195b9674a96a10754a57bcee9cd2094d2436047497a016a7bd50060f70a81dd97d66f0e3617744b45bf7b7650db2b424dfd058e4c00b39a26a722011ec95bea2f358d23d9a56fcf0975642d539c78e7ed91326dfb49957477a06aee804587b3323cff3fa4ee356892011c7928b99b1479af80b05b4b485dd1fd234e0940bbe73a9b6a0e795f5dc5f6e06df66516b3a85254ae11f70e0f946f013bd077ca7ec82035b3d1f0b513f36fef25a755f1085ac959eb1fb1b6f36289d3a737405360070111e340c45f7560ab9",
					PrivateKey:  "6f3a0afe10e9a5fb192212ce2901f5332a715f41cf003d507c708b1a88303574a42bb78479e23ec252609ef939dee51a0a233b220435feaef50ae696626d5d1ccad37ebb6b2fdd609141a4cd702eba18b5fee27d2d6e142e216b131c9124198e195a8434a3f4b1cdad2c5a2d26421dfc01dbe8326b1685a3524b05f5a0c2c6eb434b87233c7b4642be4c793a93b97ee71ccb9a0bd4e811f1c414cd3b0a1311b6c5addf702340f6b8a6462e4c82ad61cf65011d8774ac5ed244776d879732f2ca22b21712b93c9f049ed53dc00bd7bea6182cf7666b8b8756800939b9a72f2ada443d506b58c0e157b347aeb80dbb98a6ddf7df65e4618b3f1b6553236ef5495efdf23f3a7f3edc8f57ccff2b3843bbc288a0b82be2ece07919872ab044712d33cd46e176d0b9b14c682776480230ee2ad95f39b5c54daee999a4f4333bf0dfb1c024014f5287c0c7c135f3c3d8c6a610548a02b249c3972f9fbfb825ecdbaeb441810c3fd2798b2667b601a67795072e71041f727ce9607558137fb4c946ffee9da0e3ff0325e52cc0193907f8dcefbce1c84d57abd0f523b29358bf9cf999db22f16f443b596d636c1e110d2eb24860cf35f3dd6a54d2f5e550ebb05ed4756cadd8e1bda3d19203c5a5b3f08b330dd6a568160b64cab75f28c5066bb79dbd30cf74d3da57875c0c29f5b5e15d97beeaa4d66920bb413f2ba2c9b8b499b9293b9c6adf3c88e55877bcc2dc7a7327ff5a6d45e3bc06bff5332028f59f75a99201494fbf4de4b12a66b2217f184f72392bb3ca4e0cbdc621ebd661244f513f007841987a81f270aa1ec6bfe8428f3e74791392e8f769eb462f8894218de99e3078199453971a39c52fad0030df6606ca94e6531faeac23fec38d9a9505154ef399880cb97192a4ad57d2a56749803b98dc197b255da6e32095cf8fb7de8f4df93ce92726c482000e5b7f0b659baa7e92e7d594edff792ff09f5b31eede3259d89450b19bf4421902cd9cdd92dd45b19009e79c69df6c40f099db513acbe1d76b034118f12db08cbcfc2c511ae65bad4b5a00479c83f184458715ec442a762ea255c56b887f1a580a73c552b242237bcbefba3a3b01be2e5b2c96cfca32e37101b769d299b82c9f95f0e40092caf935010c241c3eba8f8b22a555d9688f5edb099d7a8cc21dda56502f311abcffbd5bd309508693280ea014d030e7e1b784ab1ecb971cec26a800f383670050129ba54efcc3dbd4e6ee99d48747eb1009107d30e9b7587929e0e9c5191db44a8f0cc3d55ddb3ea8fcf5af1aad9daa286cfae4f0e774e30e1ca7468172d6bce9cc82db6c9b800ed1ac4a27911864592765492245e92ae64a2468852fac50c0bd47a495bac6c2dd785a85032b80776bb6b6c47dae49b721526e0825867a4bcfbf0f79b309e727f97a9a3581f703fc0edff609c61a783921b620bdcb7e9657493a500fa188372b977e07d9a8ff83c27946119590095b9b1276c78c9d1beb5dd88883d3f1cd7e6e9e72225442317b586ea32bee2b4b75bd146f99e2f05fe394ca3066421e3d94131153ceb7b0e415b37e3d22580390ce30cc03f8b4d05d660a3de069e459796ed0dadaf0106b3677e504bf25465150a62d82a0a77c447fb8de33bfdc7a3d85a57a9c269a6b7d42257e729fad9341add2a146f4375d27e18eed4e4a54a49ecf35e32a990f6e4baace186f03c073a3d13662eb616e83cff7032802ed0a7d10cc658cf54a0ca04666fe6e967cb7719fa5a87e3bae36e8960b5fc83c542e8f051243ef585d865fe1d509544181ca1847e833d2c4d676c8fd72800c59ef878f805cf916ba161d5e561c787ca813a8cb2bbefa5d02f383d1e899d14e8e63d4962f2e9d4ebb1ebd25a00beebf0cfee09caef843f5a66022c55ff7a8f32f1a7ca9f4c0e62c8b8b6ac1a825ee7e44ad2a50e1c3a4146ca85ba9f57549ce93f48115b746e43438443b113a8a3e7f9e3ff777e19118ae114ee005cca51cf09c7db2a590d6c48b560c0e79c123034519fe9909aaed9196890969a801ce85b75cbc796f0ab192f67aae22e868b3142e379d53cd035e20bb6857327ec9314c88e8e3646c6e2e7d73b3b18e87a60a0441d6f193ca89694d657682bc6d50dad7649d43463f53cef64c2c807535e4abf29aa87cabeb07253ec1d0ada54e204892852c017e211824840b5cd19d1b0c47ee718ace2dbf919a15291bdc31a285b6c962ed971a0c7c3669fcbf36e13bc584e2300e59606ba803ee04cd7c5fbb0533c7b57f8acc718a75ddba4e94c6c612336e32f91bd5cd640e4b3b47cc2f3121fbe7d15895541c54ab804eb3985796164d009862b2cd522403ddf23ab3b0f306c3cb4f6dfab6e561fe551d250a55ef9465e733a6baf7a6f1866f591aa4ddc4492f85f4dccb47858f40252cbde1272a6fed",
				},
				{
					Id:          uint64(utils.Id()),
					Domain:      "test.anson.com",
					Certificate: "d019dd1c536a7f5a90953e4bf92017c02b0e4880618dd48b3072d01e8deab1593630968b21e4c64e0feff77385ccd5a5b5d6afd116be9d2dc42479f9dd392963effad5dcfbec71d75f46bf7d9520830528601a73c850ab428b974ae734f716ed594dbf2a729d1105b081ac2857590dd956c936d69620b15775e2bb96cc0dea9c325c2cacecdcbdbcbaad81f8547e31d51a8717b94a3e62dcfcb3f0e52955ef6146fc370041c06d84dea27ec4137bf49cf97c0032b0513e12c6d6aa5c45025a9f11e539c28d42691bdfdeb32ce23479004c6f91f26f0eb3969a20a77b56e9239bfd629ed5a58602bf181b6b8125deecccf404e41246db76138596c9a26153f0b1b557ef800159032baf21d3fc9061db0a0d794de1e6aa201413540cd07fbdb472151b5ab70103b8e82f5e8eb16092cd05aae704b897fc2b133a9322bcafc44f5a4ec61ba1d28df20825b71f7e5b251c2aac8e3e5eab0a79a30f404d3613c6712ec17dd5c6f7cbdf60c0f97c2e8053b3c8da0ab92393f88c1b6650bfa4f40ab6a83a677963ae7b685920ae45b89f644c3bd5008ba19cac6aa8b0fd843ad69bfd8dbbd4f41560dbf77eb791a0959199ab3c2cfa5867f4419faa73ea11e20a3a3fe4dbccb728d79d4fb543ed069798bbf91b289ada03fe01ef2ad8709779c336b162050e6bc2536f0be4c99abfad0192ae7daa4fd893df0581d7713df8d198898b7baa51e3725f4d7413efa294f52f0f00971e233135c9b44cee83979a70532769f123eeb6e67248987127cae00cdee7c4f934eb5b8fcd15f9464915c2597f7f2058b75184d5ba5a84761a9793bff56e5cccdf1439921fe7a413d25988ecd664152acf5021993f70e40182f6b2f16c4a8f383b711e836111a120ae2011a26c51f65c80920b28dae728d8635b8ebc8f3beece2f132ea2d244a51639e9a74844012e984fd56fc061223a9361d76f888794b4d9dc8d0b3ec8d33adda44702359ec5978305998a92ece4799a6f06bfe1c969553bf57598addf5f6e3446fb74896892e52fcb8377a54417cc7f0b4016017b52197640b19ed2e23443a28403d1a3dc500042ca43657e455da0c01c7c3c4b5653599bbe695119253e2c14838e590b0fdebc43c8539827797d57a6478a21d23dea7e4fe7fe320b54f62843c736d7b564f747cd52c525dbd286ea3e62708d70c0ec3cb285bb49483a1cdf5500fd2b297052af4e684357469e40c1f063f129616a4cbc80f07a699ec8617ffe2ea4e5aa08a9f530e2e8f996babd1614731660604d12083583367a0a15b6f1b549ac8dea1cb3d70d3965e767d694191d209c4f428125f9ca318326ca2ec663d370a7a24a94c1a3021957b7ab847bbd6e55fbb7a07ed6b1cf4c81822af620c5f37bf4b4b167c15c8fb99262ed1ba3640210c56947d184d4431a4a76a5277c05d3dcf7163e053d8879a6f1946380f92cb0d8113e57b03b96ca3ddc24a6a609dae76f0c9b445f388b4a78837d83b078dca65867ac6029146e55c5313274e60b452a9e0647e07fc74aebd1fc59caa97a46229ca66e392830d83d21da78c69e533e35eb9ec428ce930bb2a62ca4002389eca590c901ef6de1cac5b669da32fa1f03d232c0e2f820329ac9a636f4f555ee9dbbd91033e071e73e562c7dea0c0ca3ebf2d1536ee5988235aa246e9a73d82371acb6f828046e7cb04c36427a81c409af82cc927b550fe08f02db8d1afaa6ad03354fabec159308ff81676495e64dda77f7c9ed9f66ba521ede6667e30db8503eb1b1272be9bf3f2c87d6b6104b1c2a727fd5bf96bfda7ef9a001f9297871d1b28a6112d3e6b77f57dcf4116b94d1b2d5bea9c517d27dee807ed377b5adba18960c2ac36d78a84fdf195b9674a96a10754a57bcee9cd2094d2436047497a016a7bd50060f70a81dd97d66f0e3617744b45bf7b7650db2b424dfd058e4c00b39a26a722011ec95bea2f358d23d9a56fcf0975642d539c78e7ed91326dfb49957477a06aee804587b3323cff3fa4ee356892011c7928b99b1479af80b05b4b485dd1fd234e0940bbe73a9b6a0e795f5dc5f6e06df66516b3a85254ae11f70e0f946f013bd077ca7ec82035b3d1f0b513f36fef25a755f1085ac959eb1fb1b6f36289d3a737405360070111e340c45f7560ab9",
					PrivateKey:  "6f3a0afe10e9a5fb192212ce2901f5332a715f41cf003d507c708b1a88303574a42bb78479e23ec252609ef939dee51a0a233b220435feaef50ae696626d5d1ccad37ebb6b2fdd609141a4cd702eba18b5fee27d2d6e142e216b131c9124198e195a8434a3f4b1cdad2c5a2d26421dfc01dbe8326b1685a3524b05f5a0c2c6eb434b87233c7b4642be4c793a93b97ee71ccb9a0bd4e811f1c414cd3b0a1311b6c5addf702340f6b8a6462e4c82ad61cf65011d8774ac5ed244776d879732f2ca22b21712b93c9f049ed53dc00bd7bea6182cf7666b8b8756800939b9a72f2ada443d506b58c0e157b347aeb80dbb98a6ddf7df65e4618b3f1b6553236ef5495efdf23f3a7f3edc8f57ccff2b3843bbc288a0b82be2ece07919872ab044712d33cd46e176d0b9b14c682776480230ee2ad95f39b5c54daee999a4f4333bf0dfb1c024014f5287c0c7c135f3c3d8c6a610548a02b249c3972f9fbfb825ecdbaeb441810c3fd2798b2667b601a67795072e71041f727ce9607558137fb4c946ffee9da0e3ff0325e52cc0193907f8dcefbce1c84d57abd0f523b29358bf9cf999db22f16f443b596d636c1e110d2eb24860cf35f3dd6a54d2f5e550ebb05ed4756cadd8e1bda3d19203c5a5b3f08b330dd6a568160b64cab75f28c5066bb79dbd30cf74d3da57875c0c29f5b5e15d97beeaa4d66920bb413f2ba2c9b8b499b9293b9c6adf3c88e55877bcc2dc7a7327ff5a6d45e3bc06bff5332028f59f75a99201494fbf4de4b12a66b2217f184f72392bb3ca4e0cbdc621ebd661244f513f007841987a81f270aa1ec6bfe8428f3e74791392e8f769eb462f8894218de99e3078199453971a39c52fad0030df6606ca94e6531faeac23fec38d9a9505154ef399880cb97192a4ad57d2a56749803b98dc197b255da6e32095cf8fb7de8f4df93ce92726c482000e5b7f0b659baa7e92e7d594edff792ff09f5b31eede3259d89450b19bf4421902cd9cdd92dd45b19009e79c69df6c40f099db513acbe1d76b034118f12db08cbcfc2c511ae65bad4b5a00479c83f184458715ec442a762ea255c56b887f1a580a73c552b242237bcbefba3a3b01be2e5b2c96cfca32e37101b769d299b82c9f95f0e40092caf935010c241c3eba8f8b22a555d9688f5edb099d7a8cc21dda56502f311abcffbd5bd309508693280ea014d030e7e1b784ab1ecb971cec26a800f383670050129ba54efcc3dbd4e6ee99d48747eb1009107d30e9b7587929e0e9c5191db44a8f0cc3d55ddb3ea8fcf5af1aad9daa286cfae4f0e774e30e1ca7468172d6bce9cc82db6c9b800ed1ac4a27911864592765492245e92ae64a2468852fac50c0bd47a495bac6c2dd785a85032b80776bb6b6c47dae49b721526e0825867a4bcfbf0f79b309e727f97a9a3581f703fc0edff609c61a783921b620bdcb7e9657493a500fa188372b977e07d9a8ff83c27946119590095b9b1276c78c9d1beb5dd88883d3f1cd7e6e9e72225442317b586ea32bee2b4b75bd146f99e2f05fe394ca3066421e3d94131153ceb7b0e415b37e3d22580390ce30cc03f8b4d05d660a3de069e459796ed0dadaf0106b3677e504bf25465150a62d82a0a77c447fb8de33bfdc7a3d85a57a9c269a6b7d42257e729fad9341add2a146f4375d27e18eed4e4a54a49ecf35e32a990f6e4baace186f03c073a3d13662eb616e83cff7032802ed0a7d10cc658cf54a0ca04666fe6e967cb7719fa5a87e3bae36e8960b5fc83c542e8f051243ef585d865fe1d509544181ca1847e833d2c4d676c8fd72800c59ef878f805cf916ba161d5e561c787ca813a8cb2bbefa5d02f383d1e899d14e8e63d4962f2e9d4ebb1ebd25a00beebf0cfee09caef843f5a66022c55ff7a8f32f1a7ca9f4c0e62c8b8b6ac1a825ee7e44ad2a50e1c3a4146ca85ba9f57549ce93f48115b746e43438443b113a8a3e7f9e3ff777e19118ae114ee005cca51cf09c7db2a590d6c48b560c0e79c123034519fe9909aaed9196890969a801ce85b75cbc796f0ab192f67aae22e868b3142e379d53cd035e20bb6857327ec9314c88e8e3646c6e2e7d73b3b18e87a60a0441d6f193ca89694d657682bc6d50dad7649d43463f53cef64c2c807535e4abf29aa87cabeb07253ec1d0ada54e204892852c017e211824840b5cd19d1b0c47ee718ace2dbf919a15291bdc31a285b6c962ed971a0c7c3669fcbf36e13bc584e2300e59606ba803ee04cd7c5fbb0533c7b57f8acc718a75ddba4e94c6c612336e32f91bd5cd640e4b3b47cc2f3121fbe7d15895541c54ab804eb3985796164d009862b2cd522403ddf23ab3b0f306c3cb4f6dfab6e561fe551d250a55ef9465e733a6baf7a6f1866f591aa4ddc4492f85f4dccb47858f40252cbde1272a6fed",
				},
			}},
			total:   1,
			wantErr: false,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {

			Init(&config.Config{Secret: "66d2e42661bc292f8237b4736a423a36"})
			c := GlobalCache

			err := c.SetRange(tt.args.certs)

			if (err != nil) && !tt.wantErr {
				t.Errorf("SetRange() error = %v, wantErr %v", err, tt.wantErr)
			}

			total := 0
			c.DB.Range(func(key, value any) bool {
				total += 1
				return true
			})

			assert.Equal(t, total, tt.total)

			c.DB.Range(func(key, value any) bool {
				s := key.(string)
				c.Delete(s)
				return true
			})
		})
	}
}

func Test_newMemoryCache(t *testing.T) {

	Init(&config.Config{})

	type args struct {
		config *config.Config
	}
	tests := []struct {
		name string
		args args
		want *MemoryCache
	}{
		{
			name: "can create instance",
			args: struct{ config *config.Config }{config: &config.Config{}},
			want: GlobalCache,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			if got := newMemoryCache(tt.args.config); !reflect.DeepEqual(got, tt.want) {
				t.Errorf("newMemoryCache() = %v, want %v", got, tt.want)
			}
		})
	}
}
